(()=>{"use strict";function t(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}var e="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2},r={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},n={};n[r.DEGREES]=2*Math.PI*6370997/360,n[r.FEET]=.3048,n[r.METERS]=1,n[r.USFEET]=1200/3937;const o=r;var i=function(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit};i.prototype.canWrapX=function(){return this.canWrapX_},i.prototype.getCode=function(){return this.code_},i.prototype.getExtent=function(){return this.extent_},i.prototype.getUnits=function(){return this.units_},i.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||n[this.units_]},i.prototype.getWorldExtent=function(){return this.worldExtent_},i.prototype.getAxisOrientation=function(){return this.axisOrientation_},i.prototype.isGlobal=function(){return this.global_},i.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},i.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},i.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},i.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},i.prototype.setWorldExtent=function(t){this.worldExtent_=t},i.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},i.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};const a=i;var s=6378137,c=Math.PI*s,l=[-c,-c,c,c],u=[-180,-85,180,85],p=function(t){function r(r){t.call(this,{code:r,units:o.METERS,extent:l,global:!0,worldExtent:u,getPointResolution:function(t,r){return t/e(r[1]/s)}})}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r}(a),h=[new p("EPSG:3857"),new p("EPSG:102100"),new p("EPSG:102113"),new p("EPSG:900913"),new p("urn:ogc:def:crs:EPSG:6.18:3:3857"),new p("urn:ogc:def:crs:EPSG::3857"),new p("http://www.opengis.net/gml/srs/epsg.xml#3857")];var d,f,y,m=[-180,-90,180,90],g=6378137*Math.PI/180,v=function(t){function e(e,r){t.call(this,{code:e,units:o.DEGREES,extent:m,axisOrientation:r,global:!0,metersPerUnit:g,worldExtent:m})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(a),_=[new v("CRS:84"),new v("EPSG:4326","neu"),new v("urn:ogc:def:crs:EPSG::4326","neu"),new v("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new v("urn:ogc:def:crs:OGC:1.3:CRS84"),new v("urn:ogc:def:crs:OGC:2:84"),new v("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new v("urn:x-ogc:def:crs:EPSG:4326","neu")],w={},E={};function L(t,e,r){var n=t.getCode(),o=e.getCode();n in E||(E[n]={}),E[n][o]=r}function x(t,e,r){var n;if(void 0!==e){for(var o=0,i=t.length;o<i;++o)e[o]=t[o];n=e}else n=t.slice();return n}function S(t,e,r){if(void 0!==e&&t!==e){for(var n=0,o=t.length;n<o;++n)e[n]=t[n];t=e}return t}function T(t){!function(t,e){w[t]=e}(t.getCode(),t),L(t,t,x)}function P(t){return"string"==typeof t?w[t]||null:t||null}function b(t){!function(t){t.forEach(T)}(t),t.forEach((function(e){t.forEach((function(t){e!==t&&L(e,t,x)}))}))}function F(t,e){return function(t,e,r){return function(t,e){return r=P(t),n=P(e),o=function(t,e){var r;return t in E&&e in E[t]&&(r=E[t][e]),r}(r.getCode(),n.getCode()),o||(o=S),o;var r,n,o}(e,r)(t,void 0,t.length)}(t,"EPSG:4326",void 0!==e?e:"EPSG:3857")}function M(t,e,r){const[n,o]=e,i=Math.floor(n),a=Math.floor(o),s=Math.ceil(n),c=Math.ceil(o),l=n-i,u=o-a,p=r[s+t*a],h=r[i+t*a],d=r[i+t*c];return(p-h)*l+(d-h)*u+(h+r[s+t*c]-p-d)*l*u+h}b(h),b(_),d=h,f=function(t,e,r){var n=t.length,o=r>1?r:2,i=e;void 0===i&&(i=o>2?t.slice():new Array(n));for(var a=c,l=0;l<n;l+=o){i[l]=a*t[l]/180;var u=s*Math.log(Math.tan(Math.PI*(t[l+1]+90)/360));u>a?u=a:u<-a&&(u=-a),i[l+1]=u}return i},y=function(t,e,r){var n=t.length,o=r>1?r:2,i=e;void 0===i&&(i=o>2?t.slice():new Array(n));for(var a=0;a<n;a+=o)i[a]=180*t[a]/c,i[a+1]=360*Math.atan(Math.exp(t[a+1]/s))/Math.PI-90;return i},_.forEach((function(t){d.forEach((function(e){L(t,e,f),L(e,t,y)}))}));class R{constructor(t,e,r,n,o){this.extent=function(t,e){return t.slice()}(o),this.dataWidth_=r,this.dataHeight_=n,this.speedBuffer_=new Float32Array(t.length),this.simpleSpeedBuffer=new Uint8Array(t.length),this.rotationBuffer_=new Float32Array(t.length),this.uBuffer_=t,this.vBuffer_=e;for(let r=0;r<t.length;++r){const n=t[r],o=e[r],i=Math.sqrt(n*n+o*o),a=Math.atan2(o,n);this.speedBuffer_[r]=i,this.simpleSpeedBuffer[r]=Math.ceil(i),this.rotationBuffer_[r]=a}}getUVSpeed(t){const e=this.dataWidth_,r=this.dataHeight_,n=function(t,e,r,n){return[(n[0]-t[0])/(t[2]-t[0])*(e-1),(Math.atan(Math.sinh(n[1]/6378137))*(180/Math.PI)+90)/180*(r-1)]}(this.extent,e,r,t);return[M(e,n,this.uBuffer_),M(e,n,this.vBuffer_)]}getRotation(t){return this.rotationBuffer_[t]}getSpeed(t){return this.speedBuffer_[t]}}var I="function"==typeof Object.assign?Object.assign:function(t,e){var r=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),o=1,i=arguments.length;o<i;++o){var a=r[o];if(null!=a)for(var s in a)a.hasOwnProperty(s)&&(n[s]=a[s])}return n};function W(t){for(var e in t)delete t[e]}function O(t,e,r,n){for(var o,i=0,a=t.length;i<a;++i)if((o=t[i]).listener===e&&o.bindTo===r)return n&&(o.deleteIndex=i),o}function B(t,e){var r=A(t);return r?r[e]:void 0}function A(t,e){var r=t.ol_lm;return!r&&e&&(r=t.ol_lm={}),r}function k(t,e){var r=B(t,e);if(r){for(var n=0,o=r.length;n<o;++n)t.removeEventListener(e,r[n].boundListener),W(r[n]);r.length=0;var i=A(t);i&&(delete i[e],0===Object.keys(i).length&&function(t){delete t.ol_lm}(t))}}function G(t,e,r,n,o){var i=A(t,!0),a=i[e];a||(a=i[e]=[]);var s=O(a,r,n,!1);return s?o||(s.callOnce=!1):(s={bindTo:n,callOnce:!!o,listener:r,target:t,type:e},t.addEventListener(e,function(t){var e=function(e){var r=t.listener,n=t.bindTo||t.target;return t.callOnce&&j(t),r.call(n,e)};return t.boundListener=e,e}(s)),a.push(s)),s}function z(t,e,r,n){return G(t,e,r,n,!0)}function C(t,e,r,n){var o=B(t,e);if(o){var i=O(o,r,n,!0);i&&j(i)}}function j(t){if(t&&t.target){t.target.removeEventListener(t.type,t.boundListener);var e=B(t.target,t.type);if(e){var r="deleteIndex"in t?t.deleteIndex:e.indexOf(t);-1!==r&&e.splice(r,1),0===e.length&&k(t.target,t.type)}W(t)}}const D="change";function K(){return function(){throw new Error("Unimplemented abstract method.")}()}var U=0;function V(t){return t.ol_uid||(t.ol_uid=String(++U))}var X=function(){this.disposed_=!1};X.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},X.prototype.disposeInternal=function(){};const H=X;function $(){}var Z=function(t){this.propagationStopped,this.type=t,this.target=null};Z.prototype.preventDefault=function(){this.propagationStopped=!0},Z.prototype.stopPropagation=function(){this.propagationStopped=!0};const Y=Z;var q=function(t){function e(){t.call(this),this.pendingRemovals_={},this.dispatching_={},this.listeners_={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addEventListener=function(t,e){var r=this.listeners_[t];r||(r=this.listeners_[t]=[]),-1===r.indexOf(e)&&r.push(e)},e.prototype.dispatchEvent=function(t){var e="string"==typeof t?new Y(t):t,r=e.type;e.target=this;var n,o=this.listeners_[r];if(o){r in this.dispatching_||(this.dispatching_[r]=0,this.pendingRemovals_[r]=0),++this.dispatching_[r];for(var i=0,a=o.length;i<a;++i)if(!1===o[i].call(this,e)||e.propagationStopped){n=!1;break}if(--this.dispatching_[r],0===this.dispatching_[r]){var s=this.pendingRemovals_[r];for(delete this.pendingRemovals_[r];s--;)this.removeEventListener(r,$);delete this.dispatching_[r]}return n}},e.prototype.disposeInternal=function(){!function(t){var e=A(t);if(e)for(var r in e)k(t,r)}(this)},e.prototype.getListeners=function(t){return this.listeners_[t]},e.prototype.hasListener=function(t){return t?t in this.listeners_:Object.keys(this.listeners_).length>0},e.prototype.removeEventListener=function(t,e){var r=this.listeners_[t];if(r){var n=r.indexOf(e);t in this.pendingRemovals_?(r[n]=$,++this.pendingRemovals_[t]):(r.splice(n,1),0===r.length&&delete this.listeners_[t])}},e}(H);const N=function(t){function e(){t.call(this),this.revision_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.changed=function(){++this.revision_,this.dispatchEvent(D)},e.prototype.getRevision=function(){return this.revision_},e.prototype.on=function(t,e){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),o=0;o<r;++o)n[o]=G(this,t[o],e);return n}return G(this,t,e)},e.prototype.once=function(t,e){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),o=0;o<r;++o)n[o]=z(this,t[o],e);return n}return z(this,t,e)},e.prototype.un=function(t,e){if(Array.isArray(t))for(var r=0,n=t.length;r<n;++r)C(this,t[r],e);else C(this,t,e)},e}(q);var J=function(t){function e(e,r,n){t.call(this,e),this.key=r,this.oldValue=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Y),Q={};function tt(t){return Q.hasOwnProperty(t)?Q[t]:Q[t]="change:"+t}const et="opacity",rt="visible",nt="extent",ot="zIndex",it="maxResolution",at="minResolution",st="source";var ct=function(t){function e(e){t.call(this);var r=I({},e);r[et]=void 0!==e.opacity?e.opacity:1,r[rt]=void 0===e.visible||e.visible,r[ot]=e.zIndex,r[it]=void 0!==e.maxResolution?e.maxResolution:1/0,r[at]=void 0!==e.minResolution?e.minResolution:0,this.setProperties(r),this.state_=null,this.type}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getType=function(){return this.type},e.prototype.getLayerState=function(){var t,e=this.state_||{layer:this,managed:!0};return e.opacity=(t=this.getOpacity(),0,1,Math.min(Math.max(t,0),1)),e.sourceState=this.getSourceState(),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=this.getZIndex()||0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),this.state_=e,e},e.prototype.getLayersArray=function(t){return K()},e.prototype.getLayerStatesArray=function(t){return K()},e.prototype.getExtent=function(){return this.get(nt)},e.prototype.getMaxResolution=function(){return this.get(it)},e.prototype.getMinResolution=function(){return this.get(at)},e.prototype.getOpacity=function(){return this.get(et)},e.prototype.getSourceState=function(){return K()},e.prototype.getVisible=function(){return this.get(rt)},e.prototype.getZIndex=function(){return this.get(ot)},e.prototype.setExtent=function(t){this.set(nt,t)},e.prototype.setMaxResolution=function(t){this.set(it,t)},e.prototype.setMinResolution=function(t){this.set(at,t)},e.prototype.setOpacity=function(t){this.set(et,t)},e.prototype.setVisible=function(t){this.set(rt,t)},e.prototype.setZIndex=function(t){this.set(ot,t)},e}(function(t){function e(e){t.call(this),V(this),this.values_={},void 0!==e&&this.setProperties(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){var e;return this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},e.prototype.getKeys=function(){return Object.keys(this.values_)},e.prototype.getProperties=function(){return I({},this.values_)},e.prototype.notify=function(t,e){var r;r=tt(t),this.dispatchEvent(new J(r,t,e)),r="propertychange",this.dispatchEvent(new J(r,t,e))},e.prototype.set=function(t,e,r){if(r)this.values_[t]=e;else{var n=this.values_[t];this.values_[t]=e,n!==e&&this.notify(t,n)}},e.prototype.setProperties=function(t,e){for(var r in t)this.set(r,t[r],e)},e.prototype.unset=function(t,e){if(t in this.values_){var r=this.values_[t];delete this.values_[t],e||this.notify(t,r)}},e}(N));var lt=function(t){function e(e){var r=I({},e);delete r.source,t.call(this,r),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,e.map&&this.setMap(e.map),G(this,tt(st),this.handleSourcePropertyChange_,this);var n=e.source?e.source:null;this.setSource(n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayersArray=function(t){var e=t||[];return e.push(this),e},e.prototype.getLayerStatesArray=function(t){var e=t||[];return e.push(this.getLayerState()),e},e.prototype.getSource=function(){return this.get(st)||null},e.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():"undefined"},e.prototype.handleSourceChange_=function(){this.changed()},e.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(j(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=G(t,D,this.handleSourceChange_,this)),this.changed()},e.prototype.setMap=function(t){this.mapPrecomposeKey_&&(j(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(j(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=G(t,"precompose",(function(t){var e=t,r=this.getLayerState();r.managed=!1,void 0===this.getZIndex()&&(r.zIndex=1/0),e.frameState.layerStatesArray.push(r),e.frameState.layerStates[V(this)]=r}),this),this.mapRenderKey_=G(this,D,t.render,t),this.changed())},e.prototype.setSource=function(t){this.set(st,t)},e}(ct);const ut=lt;function pt(t,e){let[r,n]=t.size;if(r*=t.pixelRatio,n*=t.pixelRatio,e.width!==r||e.height!==n)return e.width=r,e.height=n,!0}function ht(t,e){var r=e[0],n=e[1];return e[0]=t[0]*r+t[2]*n+t[4],e[1]=t[1]*r+t[3]*n+t[5],e}new Array(6);const dt=[];class ft extends N{constructor(t){super(),this.layer=t,this.canvases_=[document.createElement("canvas"),document.createElement("canvas")],this.previousFrame_={canvasId:0,centerX:0,centerY:0,resolution:1/0}}static handles(t){return t instanceof yt}static create(t,e){return new ft(e)}prepareFrame(t){const e=this.layer,r=this.canvases_[this.previousFrame_.canvasId];let n=r;const o=pt(t,r);let i=this.previousFrame_.canvasId;const[a,s]=t.viewState.center,c=t.viewState.resolution;if(!o&&this.previousFrame_.resolution===c){dt[0]=this.previousFrame_.centerX,dt[1]=this.previousFrame_.centerY,ht(t.coordinateToPixelTransform,dt);const e=dt[0]-t.size[0]/2,o=dt[1]-t.size[1]/2;if(0!==e||0!==o){i=(i+1)%2,n=this.canvases_[i],pt(t,n);const a=n.getContext("2d");a.clearRect(0,0,n.width,n.height),a.drawImage(r,e,o)}}this.previousFrame_.canvasId=i,this.previousFrame_.centerX=a,this.previousFrame_.centerY=s,this.previousFrame_.resolution=c;const l=n.getContext("2d");return e.doRender_(t,l),t.animate=!0,!0}composeFrame(t,e,r){const n=this.canvases_[this.previousFrame_.canvasId],o=n.width,i=n.height;r.drawImage(n,0,0,o,i)}}class yt extends ut{constructor(t){super({}),this.doRender_=t.renderFunction}getSourceState(){return"ready"}}function mt(t,e){var r,n;e[0]=Math.random()*function(t){return t[2]-t[0]}(t)+t[0],e[1]=(r=Math.random(),n=Math.PI*(r-.5),Math.log(Math.tan(Math.PI/4+n/2))/Math.PI*20037508.34)}class gt extends yt{constructor(t){super({renderFunction:(e,r)=>{let n;return n=t.uvBuffer1?"dimgray":4==brightMode?"#777777":"white",this.render(e,r,n)}}),this.fading=t.fading||.8,console.assert(t.ttl),this.ttl=t.ttl,console.assert(t.map),this.map=t.map,console.assert(t.particleSize1),console.assert(t.particleSize2),this.particleSize1=t.particleSize1,this.particleSize2=t.particleSize2;const e=[t.uvBuffer1,t.uvBuffer2,t.uvBuffer3];for(const t of e)if(t){console.assert(t),this.uvBuffer=t;break}console.assert(t.particles),this.particles=new Array(t.particles);for(let e=0;e<t.particles;++e)this.particles[e]={ttl:Math.random()*this.ttl,coordinates:[]};this.pixel=[],this.viewportWithDataExtent=[1/0,1/0,-1/0,-1/0],this.map.getRenderer().registerLayerRenderers([ft])}render(t,e,r){const n=e.canvas;e.fillStyle=r,this.advanceParticles(t,e),e.globalAlpha=this.fading,e.globalCompositeOperation="destination-in",e.fillRect(0,0,n.width,n.height),e.globalAlpha=1,e.globalCompositeOperation="source-over"}advanceParticles(t,e){if(n=this.uvBuffer.extent,o=t.extent,i=this.viewportWithDataExtent,a=i||[1/0,1/0,-1/0,-1/0],function(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}(n,o)?(n[0]>o[0]?a[0]=n[0]:a[0]=o[0],n[1]>o[1]?a[1]=n[1]:a[1]=o[1],n[2]<o[2]?a[2]=n[2]:a[2]=o[2],n[3]<o[3]?a[3]=n[3]:a[3]=o[3]):function(t){!function(t,e,r,n,o){o&&(o[0]=t,o[1]=e,o[2]=r,o[3]=n)}(1/0,1/0,-1/0,-1/0,t)}(a),(r=this.viewportWithDataExtent)[2]<r[0]||r[3]<r[1])return;var r,n,o,i,a;const s=this.pixel,c=t.viewState.resolution,l=t.pixelRatio;this.particles.forEach((r=>{var n;0!==r.coordinates.length&&function(t,e,r){return t[0]<=e&&e<=t[2]&&t[1]<=r&&r<=t[3]}(this.viewportWithDataExtent,(n=r.coordinates)[0],n[1])||mt(this.viewportWithDataExtent,r.coordinates),s[0]=r.coordinates[0],s[1]=r.coordinates[1];const[o,i]=this.uvBuffer.getUVSpeed(r.coordinates);if(0!==o&&0!==i){ht(t.coordinateToPixelTransform,s);const n=function(t,e){return Math.atan2(t,e)*(180/Math.PI)}(o,i);e.save(),e.translate(s[0]*l,s[1]*l),e.rotate(n*Math.PI/180),r.ttl>this.ttl/2?e.globalAlpha=2*(1-r.ttl/this.ttl):e.globalAlpha=r.ttl/this.ttl*2,e.fillRect(-this.particleSize1*l/2,-this.particleSize2*l/2,this.particleSize1*l,this.particleSize2*l),e.restore()}--r.ttl,r.ttl<0&&(mt(this.viewportWithDataExtent,r.coordinates),r.ttl=this.ttl),r.coordinates[0]+=o*c,r.coordinates[1]+=i*c}))}}let vt=.5;var _t,wt,Et,Lt,xt;function St(){document.getElementById("weatherTime").innerText=Mt(weatherTime),addLayerWind||addLayerFlow||addLayerWave?It(!1):(addLayerTempair||addLayerTempwater)&&It(!0)}function Tt(){addLayerWind?(addLayerWind=!1,map.removeLayer(layerWind1)):addLayerFlow?(addLayerFlow=!1,map.removeLayer(layerFlow1)):addLayerWave?(addLayerWave=!1,map.removeLayer(layerWave1)):(addLayerTempair||addLayerTempwater)&&(addLayerTempair?(addLayerTempair=!1,map.removeLayer(layerTempair)):addLayerTempwater&&(addLayerTempwater=!1,map.removeLayer(layerTempwater)),document.querySelector("#tempLegend").remove())}function Pt(){const t=document.createElement("div");t.id="tempLegend",t.style.position="absolute",t.style.top="30px",t.style.right="0px",t.style.width="45px",t.style.height="162px",t.style.backgroundImage="url(images/emap/legend_temp.png)",t.style.opacity="1",document.body.appendChild(t)}let bt;function Ft(t){let e;switch(console.log("lev : "+lev),lev){case 0:e=2;break;case 1:e=4;break;case 2:default:e=8;break;case 3:e=5.5;break;case 4:e=6;break;case 5:case 6:e=10.5;break;case 7:case 8:case 9:e=9}console.log("radius : "+e),t.setRadius(e),t.changed()}function Mt(t){let e=t.getFullYear(),r=t.getMonth()+1,n=t.getDate();r=r<10?"0"+r:r,n=n<10?"0"+n:n;let o=t.getHours();return o=3*parseInt(o/3)+"시",o=o<10?"0"+o:o,e+"-"+r+"-"+n+" "+o}function Rt(t){weatherTime.setHours(weatherTime.getHours()+t)}function It(e){let r=Mt(weatherTime);let n,o,i,a=[1/0,1/0,-1/0,-1/0];!async function(r){let s,c=map.getView().calculateExtent(map.getSize()),l=ol.proj.transform(ol.extent.getBottomLeft(c),"EPSG:3857","EPSG:4326"),u=ol.proj.transform(ol.extent.getTopRight(c),"EPSG:3857","EPSG:4326"),p=-90,h=90;e&&(p=l[1],h=u[1]);let d=r.slice(0,10).replace(/-/g,""),f=r.slice(11,13);if(f.endsWith("시")&&(f=f.charAt(0)),s=await fetch(`./getWeather.do?date=${d}&time=${f}&lat1=${p}&lat2=${h}&lon1=${l[0]}&lon2=${u[0]}&degree=${vt}`),s.ok){try{i=await s.json()}catch(t){return void alert("기상 데이터가 없습니다.")}var y=new Set,m=new Set;i.forEach((function(t){t.hasOwnProperty("lat")&&y.add(t.lat),t.hasOwnProperty("lon")&&m.add(t.lon)})),n=m.size,o=y.size,function(){addLayerWind?map.removeLayer(layerWind1):addLayerFlow?map.removeLayer(layerFlow1):addLayerWave?map.removeLayer(layerWave1):layerTempair?(map.removeLayer(layerTempair),map.removeLayer(layerTempair)):layerTempwater&&(map.removeLayer(layerTempwater),map.removeLayer(layerTempwater));const e=[],r=[],s=[],c=[],l=[],u=[];function p(t,e){return t.map((t=>t[e]))}const h=p(i,"lat"),d=p(i,"lon"),f=p(i,"ugrd10m"),y=p(i,"vgrd10m"),m=p(i,"u_current"),g=p(i,"v_current"),v=p(i,"fwaveu"),_=p(i,"fwavev"),w=p(i,"water_temp"),E=p(i,"fsdir"),L=p(i,"fshgt");for(let n=0;n<h.length;n++){const o=F([parseFloat(d[n]),parseFloat(h[n])]),i=f[n]/27,p=y[n]/27;let x=m[n],S=g[n];0==w[n]&&0==E[n]&&0==L[n]&&(x=0,S=0);let T=v[n]/70,P=_[n]/70;e.push(i),r.push(p),s.push(x),c.push(S),l.push(T),u.push(P),t(a,o)}const x=new Float32Array(e),S=new Float32Array(r),T=new Float32Array(s),P=new Float32Array(c),b=new Float32Array(l),M=new Float32Array(u),I=new R(x,S,n,o,a),W=new R(T,P,n,o,a),O=new R(b,M,n,o,a);let B;if(layerWind1=new gt({map,uvBuffer1:I,particles:5e3,fading:.95,ttl:400,particleSize1:1.5,particleSize2:1.5}),layerFlow1=new gt({map,uvBuffer2:W,particles:2e4,fading:.95,ttl:400,particleSize1:1.5,particleSize2:1.5}),layerWave1=new gt({map,uvBuffer3:O,particles:5e3,fading:.45,ttl:150,particleSize1:6,particleSize2:3}),lev>=3){let t;t=lev<=3?.2:lev<=5?.1:lev<=6?.05:lev<=7?.02:lev<=8?.01:lev<=9?.005:.002;const e=[];i.map(((r,n,o)=>{if(n<o.length-1){const i=o[n+1],a=i.lat-r.lat,s=i.lon-r.lon,c=Math.round(Math.abs(a)/t),l=Math.round(Math.abs(s)/t);for(let t=0;t<c;t++)for(let n=0;n<l;n++){const o=a/c*t,u=s/l*n,p=r.lat+o,h=r.lon+u,d=parseFloat(r.air_temp)+(parseFloat(i.air_temp)-parseFloat(r.air_temp))/(c*l)*(t*l+n);e.push({lat:p,lon:h,air_temp:d.toFixed(2)})}}})),B=e}else B=i;layerTempair=new ol.layer.Heatmap({source:new ol.source.Vector({features:B.map((t=>{const e=(Math.min(Math.max(parseFloat(t.air_temp),-20),40)- -20)/60;return new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([parseFloat(t.lon),parseFloat(t.lat)])),weight:e})}))}),blur:15,radius:1,weight:function(t){return t.get("weight")},opacity:.5}),layerTempwater=new ol.layer.Heatmap({source:new ol.source.Vector({features:B.map((t=>{const e=(Math.min(Math.max(parseFloat(t.water_temp),-20),40)- -20)/60;return new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([parseFloat(t.lon),parseFloat(t.lat)])),weight:e})}))}),blur:15,radius:1,weight:function(t){return t.get("weight")},opacity:.5}),addLayerWind&&map.addLayer(layerWind1),addLayerFlow&&map.addLayer(layerFlow1),addLayerWave&&map.addLayer(layerWave1),addLayerTempair&&(map.addLayer(layerTempair),Ft(layerTempair)),addLayerTempwater&&(map.addLayer(layerTempwater),Ft(layerTempwater))}()}else alert("서버 응답이 없습니다.")}(r)}lev=4,_t=document.getElementById("checkWind"),wt=document.getElementById("checkFlow"),Et=document.getElementById("checkWave"),Lt=document.getElementById("checkTempair"),xt=document.getElementById("checkTempwater"),_t.addEventListener("change",(function(){_t.checked&&(Tt(),addLayerWind=!0,It(!1))})),wt.addEventListener("change",(function(){wt.checked&&(Tt(),addLayerFlow=!0,It(!1))})),Et.addEventListener("change",(function(){Et.checked&&(Tt(),addLayerWave=!0,It(!1))})),Lt.addEventListener("change",(function(){Lt.checked&&(Tt(),addLayerTempair=!0,It(!0),Pt())})),xt.addEventListener("change",(function(){xt.checked&&(Tt(),addLayerTempwater=!0,It(!0),Pt())})),map.on("movestart",(function(){addLayerWind?map.removeLayer(layerWind1):addLayerFlow?map.removeLayer(layerFlow1):addLayerWave?map.removeLayer(layerWave1):addLayerTempair?map.removeLayer(layerTempair):addLayerTempwater&&map.removeLayer(layerTempwater)})),map.on("moveend",(function(){addLayerWind||addLayerFlow||addLayerWave?It(!1):(addLayerTempair||addLayerTempwater)&&It(!0)})),map.getView().on("change:resolution",(function(){lev=map.getView().getZoom(),clearTimeout(bt),bt=setTimeout((function(){Number.isInteger(lev)&&(vt=.5)}),250)})),document.getElementById("weatherTime").innerText=Mt(weatherTime),document.getElementById("timeMinus12").addEventListener("click",(function(){Rt(-12),St()})),document.getElementById("timeMinus3").addEventListener("click",(function(){Rt(-3),St()})),document.getElementById("timeNow").addEventListener("click",(function(){weatherTime=new Date,St()})),document.getElementById("timePlus3").addEventListener("click",(function(){Rt(3),St()})),document.getElementById("timePlus12").addEventListener("click",(function(){Rt(12),St()})),dateInput=document.getElementById("selectDate"),dateInput.addEventListener("change",(function(t){let e=new Date(t.target.value);weatherTime=e,St()}))})();