(()=>{"use strict";function e(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}var t="cosh"in Math?Math.cosh:function(e){var t=Math.exp(e);return(t+1/t)/2},n={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},r={};r[n.DEGREES]=2*Math.PI*6370997/360,r[n.FEET]=.3048,r[n.METERS]=1,r[n.USFEET]=1200/3937;const o=n;var i=function(e){this.code_=e.code,this.units_=e.units,this.extent_=void 0!==e.extent?e.extent:null,this.worldExtent_=void 0!==e.worldExtent?e.worldExtent:null,this.axisOrientation_=void 0!==e.axisOrientation?e.axisOrientation:"enu",this.global_=void 0!==e.global&&e.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit};i.prototype.canWrapX=function(){return this.canWrapX_},i.prototype.getCode=function(){return this.code_},i.prototype.getExtent=function(){return this.extent_},i.prototype.getUnits=function(){return this.units_},i.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||r[this.units_]},i.prototype.getWorldExtent=function(){return this.worldExtent_},i.prototype.getAxisOrientation=function(){return this.axisOrientation_},i.prototype.isGlobal=function(){return this.global_},i.prototype.setGlobal=function(e){this.global_=e,this.canWrapX_=!(!e||!this.extent_)},i.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},i.prototype.setDefaultTileGrid=function(e){this.defaultTileGrid_=e},i.prototype.setExtent=function(e){this.extent_=e,this.canWrapX_=!(!this.global_||!e)},i.prototype.setWorldExtent=function(e){this.worldExtent_=e},i.prototype.setGetPointResolution=function(e){this.getPointResolutionFunc_=e},i.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};const a=i;var s=6378137,c=Math.PI*s,l=[-c,-c,c,c],u=[-180,-85,180,85],p=function(e){function n(n){e.call(this,{code:n,units:o.METERS,extent:l,global:!0,worldExtent:u,getPointResolution:function(e,n){return e/t(n[1]/s)}})}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n}(a),h=[new p("EPSG:3857"),new p("EPSG:102100"),new p("EPSG:102113"),new p("EPSG:900913"),new p("urn:ogc:def:crs:EPSG:6.18:3:3857"),new p("urn:ogc:def:crs:EPSG::3857"),new p("http://www.opengis.net/gml/srs/epsg.xml#3857")];var d,f,y,m=[-180,-90,180,90],g=6378137*Math.PI/180,v=function(e){function t(t,n){e.call(this,{code:t,units:o.DEGREES,extent:m,axisOrientation:n,global:!0,metersPerUnit:g,worldExtent:m})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(a),_=[new v("CRS:84"),new v("EPSG:4326","neu"),new v("urn:ogc:def:crs:EPSG::4326","neu"),new v("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new v("urn:ogc:def:crs:OGC:1.3:CRS84"),new v("urn:ogc:def:crs:OGC:2:84"),new v("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new v("urn:x-ogc:def:crs:EPSG:4326","neu")],w={},E={};function L(e,t,n){var r=e.getCode(),o=t.getCode();r in E||(E[r]={}),E[r][o]=n}function x(e,t,n){var r;if(void 0!==t){for(var o=0,i=e.length;o<i;++o)t[o]=e[o];r=t}else r=e.slice();return r}function S(e,t,n){if(void 0!==t&&e!==t){for(var r=0,o=e.length;r<o;++r)t[r]=e[r];e=t}return e}function T(e){!function(e,t){w[e]=t}(e.getCode(),e),L(e,e,x)}function P(e){return"string"==typeof e?w[e]||null:e||null}function b(e){!function(e){e.forEach(T)}(e),e.forEach((function(t){e.forEach((function(e){t!==e&&L(t,e,x)}))}))}function F(e,t){return function(e,t,n){return function(e,t){return n=P(e),r=P(t),o=function(e,t){var n;return e in E&&t in E[e]&&(n=E[e][t]),n}(n.getCode(),r.getCode()),o||(o=S),o;var n,r,o}(t,n)(e,void 0,e.length)}(e,"EPSG:4326",void 0!==t?t:"EPSG:3857")}function M(e,t,n){const[r,o]=t,i=Math.floor(r),a=Math.floor(o),s=Math.ceil(r),c=Math.ceil(o),l=r-i,u=o-a,p=n[s+e*a],h=n[i+e*a],d=n[i+e*c];return(p-h)*l+(d-h)*u+(h+n[s+e*c]-p-d)*l*u+h}b(h),b(_),d=h,f=function(e,t,n){var r=e.length,o=n>1?n:2,i=t;void 0===i&&(i=o>2?e.slice():new Array(r));for(var a=c,l=0;l<r;l+=o){i[l]=a*e[l]/180;var u=s*Math.log(Math.tan(Math.PI*(e[l+1]+90)/360));u>a?u=a:u<-a&&(u=-a),i[l+1]=u}return i},y=function(e,t,n){var r=e.length,o=n>1?n:2,i=t;void 0===i&&(i=o>2?e.slice():new Array(r));for(var a=0;a<r;a+=o)i[a]=180*e[a]/c,i[a+1]=360*Math.atan(Math.exp(e[a+1]/s))/Math.PI-90;return i},_.forEach((function(e){d.forEach((function(t){L(e,t,f),L(t,e,y)}))}));class R{constructor(e,t,n,r,o){this.extent=function(e,t){return e.slice()}(o),this.dataWidth_=n,this.dataHeight_=r,this.speedBuffer_=new Float32Array(e.length),this.simpleSpeedBuffer=new Uint8Array(e.length),this.rotationBuffer_=new Float32Array(e.length),this.uBuffer_=e,this.vBuffer_=t;for(let n=0;n<e.length;++n){const r=e[n],o=t[n],i=Math.sqrt(r*r+o*o),a=Math.atan2(o,r);this.speedBuffer_[n]=i,this.simpleSpeedBuffer[n]=Math.ceil(i),this.rotationBuffer_[n]=a}}getUVSpeed(e){const t=this.dataWidth_,n=this.dataHeight_,r=function(e,t,n,r){return[(r[0]-e[0])/(e[2]-e[0])*(t-1),(Math.atan(Math.sinh(r[1]/6378137))*(180/Math.PI)+90)/180*(n-1)]}(this.extent,t,n,e);return[M(t,r,this.uBuffer_),M(t,r,this.vBuffer_)]}getRotation(e){return this.rotationBuffer_[e]}getSpeed(e){return this.speedBuffer_[e]}}var I="function"==typeof Object.assign?Object.assign:function(e,t){var n=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),o=1,i=arguments.length;o<i;++o){var a=n[o];if(null!=a)for(var s in a)a.hasOwnProperty(s)&&(r[s]=a[s])}return r};function W(e){for(var t in e)delete e[t]}function O(e,t,n,r){for(var o,i=0,a=e.length;i<a;++i)if((o=e[i]).listener===t&&o.bindTo===n)return r&&(o.deleteIndex=i),o}function B(e,t){var n=A(e);return n?n[t]:void 0}function A(e,t){var n=e.ol_lm;return!n&&t&&(n=e.ol_lm={}),n}function G(e,t){var n=B(e,t);if(n){for(var r=0,o=n.length;r<o;++r)e.removeEventListener(t,n[r].boundListener),W(n[r]);n.length=0;var i=A(e);i&&(delete i[t],0===Object.keys(i).length&&function(e){delete e.ol_lm}(e))}}function k(e,t,n,r,o){var i=A(e,!0),a=i[t];a||(a=i[t]=[]);var s=O(a,n,r,!1);return s?o||(s.callOnce=!1):(s={bindTo:r,callOnce:!!o,listener:n,target:e,type:t},e.addEventListener(t,function(e){var t=function(t){var n=e.listener,r=e.bindTo||e.target;return e.callOnce&&j(e),n.call(r,t)};return e.boundListener=t,t}(s)),a.push(s)),s}function z(e,t,n,r){return k(e,t,n,r,!0)}function C(e,t,n,r){var o=B(e,t);if(o){var i=O(o,n,r,!0);i&&j(i)}}function j(e){if(e&&e.target){e.target.removeEventListener(e.type,e.boundListener);var t=B(e.target,e.type);if(t){var n="deleteIndex"in e?e.deleteIndex:t.indexOf(e);-1!==n&&t.splice(n,1),0===t.length&&G(e.target,e.type)}W(e)}}const D="change";function K(){return function(){throw new Error("Unimplemented abstract method.")}()}var U=0;function V(e){return e.ol_uid||(e.ol_uid=String(++U))}var X=function(){this.disposed_=!1};X.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},X.prototype.disposeInternal=function(){};const H=X;function $(){}var Z=function(e){this.propagationStopped,this.type=e,this.target=null};Z.prototype.preventDefault=function(){this.propagationStopped=!0},Z.prototype.stopPropagation=function(){this.propagationStopped=!0};const Y=Z;var q=function(e){function t(){e.call(this),this.pendingRemovals_={},this.dispatching_={},this.listeners_={}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addEventListener=function(e,t){var n=this.listeners_[e];n||(n=this.listeners_[e]=[]),-1===n.indexOf(t)&&n.push(t)},t.prototype.dispatchEvent=function(e){var t="string"==typeof e?new Y(e):e,n=t.type;t.target=this;var r,o=this.listeners_[n];if(o){n in this.dispatching_||(this.dispatching_[n]=0,this.pendingRemovals_[n]=0),++this.dispatching_[n];for(var i=0,a=o.length;i<a;++i)if(!1===o[i].call(this,t)||t.propagationStopped){r=!1;break}if(--this.dispatching_[n],0===this.dispatching_[n]){var s=this.pendingRemovals_[n];for(delete this.pendingRemovals_[n];s--;)this.removeEventListener(n,$);delete this.dispatching_[n]}return r}},t.prototype.disposeInternal=function(){!function(e){var t=A(e);if(t)for(var n in t)G(e,n)}(this)},t.prototype.getListeners=function(e){return this.listeners_[e]},t.prototype.hasListener=function(e){return e?e in this.listeners_:Object.keys(this.listeners_).length>0},t.prototype.removeEventListener=function(e,t){var n=this.listeners_[e];if(n){var r=n.indexOf(t);e in this.pendingRemovals_?(n[r]=$,++this.pendingRemovals_[e]):(n.splice(r,1),0===n.length&&delete this.listeners_[e])}},t}(H);const N=function(e){function t(){e.call(this),this.revision_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.changed=function(){++this.revision_,this.dispatchEvent(D)},t.prototype.getRevision=function(){return this.revision_},t.prototype.on=function(e,t){if(Array.isArray(e)){for(var n=e.length,r=new Array(n),o=0;o<n;++o)r[o]=k(this,e[o],t);return r}return k(this,e,t)},t.prototype.once=function(e,t){if(Array.isArray(e)){for(var n=e.length,r=new Array(n),o=0;o<n;++o)r[o]=z(this,e[o],t);return r}return z(this,e,t)},t.prototype.un=function(e,t){if(Array.isArray(e))for(var n=0,r=e.length;n<r;++n)C(this,e[n],t);else C(this,e,t)},t}(q);var J=function(e){function t(t,n,r){e.call(this,t),this.key=n,this.oldValue=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Y),Q={};function ee(e){return Q.hasOwnProperty(e)?Q[e]:Q[e]="change:"+e}const te="opacity",ne="visible",re="extent",oe="zIndex",ie="maxResolution",ae="minResolution",se="source";var ce=function(e){function t(t){e.call(this);var n=I({},t);n[te]=void 0!==t.opacity?t.opacity:1,n[ne]=void 0===t.visible||t.visible,n[oe]=t.zIndex,n[ie]=void 0!==t.maxResolution?t.maxResolution:1/0,n[ae]=void 0!==t.minResolution?t.minResolution:0,this.setProperties(n),this.state_=null,this.type}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getType=function(){return this.type},t.prototype.getLayerState=function(){var e,t=this.state_||{layer:this,managed:!0};return t.opacity=(e=this.getOpacity(),0,1,Math.min(Math.max(e,0),1)),t.sourceState=this.getSourceState(),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=this.getZIndex()||0,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),this.state_=t,t},t.prototype.getLayersArray=function(e){return K()},t.prototype.getLayerStatesArray=function(e){return K()},t.prototype.getExtent=function(){return this.get(re)},t.prototype.getMaxResolution=function(){return this.get(ie)},t.prototype.getMinResolution=function(){return this.get(ae)},t.prototype.getOpacity=function(){return this.get(te)},t.prototype.getSourceState=function(){return K()},t.prototype.getVisible=function(){return this.get(ne)},t.prototype.getZIndex=function(){return this.get(oe)},t.prototype.setExtent=function(e){this.set(re,e)},t.prototype.setMaxResolution=function(e){this.set(ie,e)},t.prototype.setMinResolution=function(e){this.set(ae,e)},t.prototype.setOpacity=function(e){this.set(te,e)},t.prototype.setVisible=function(e){this.set(ne,e)},t.prototype.setZIndex=function(e){this.set(oe,e)},t}(function(e){function t(t){e.call(this),V(this),this.values_={},void 0!==t&&this.setProperties(t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(e){var t;return this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t},t.prototype.getKeys=function(){return Object.keys(this.values_)},t.prototype.getProperties=function(){return I({},this.values_)},t.prototype.notify=function(e,t){var n;n=ee(e),this.dispatchEvent(new J(n,e,t)),n="propertychange",this.dispatchEvent(new J(n,e,t))},t.prototype.set=function(e,t,n){if(n)this.values_[e]=t;else{var r=this.values_[e];this.values_[e]=t,r!==t&&this.notify(e,r)}},t.prototype.setProperties=function(e,t){for(var n in e)this.set(n,e[n],t)},t.prototype.unset=function(e,t){if(e in this.values_){var n=this.values_[e];delete this.values_[e],t||this.notify(e,n)}},t}(N));var le=function(e){function t(t){var n=I({},t);delete n.source,e.call(this,n),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,t.map&&this.setMap(t.map),k(this,ee(se),this.handleSourcePropertyChange_,this);var r=t.source?t.source:null;this.setSource(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getLayersArray=function(e){var t=e||[];return t.push(this),t},t.prototype.getLayerStatesArray=function(e){var t=e||[];return t.push(this.getLayerState()),t},t.prototype.getSource=function(){return this.get(se)||null},t.prototype.getSourceState=function(){var e=this.getSource();return e?e.getState():"undefined"},t.prototype.handleSourceChange_=function(){this.changed()},t.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(j(this.sourceChangeKey_),this.sourceChangeKey_=null);var e=this.getSource();e&&(this.sourceChangeKey_=k(e,D,this.handleSourceChange_,this)),this.changed()},t.prototype.setMap=function(e){this.mapPrecomposeKey_&&(j(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(j(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=k(e,"precompose",(function(e){var t=e,n=this.getLayerState();n.managed=!1,void 0===this.getZIndex()&&(n.zIndex=1/0),t.frameState.layerStatesArray.push(n),t.frameState.layerStates[V(this)]=n}),this),this.mapRenderKey_=k(this,D,e.render,e),this.changed())},t.prototype.setSource=function(e){this.set(se,e)},t}(ce);const ue=le;function pe(e,t){let[n,r]=e.size;if(n*=e.pixelRatio,r*=e.pixelRatio,t.width!==n||t.height!==r)return t.width=n,t.height=r,!0}function he(e,t){var n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}new Array(6);const de=[];class fe extends N{constructor(e){super(),this.layer=e,this.canvases_=[document.createElement("canvas"),document.createElement("canvas")],this.previousFrame_={canvasId:0,centerX:0,centerY:0,resolution:1/0}}static handles(e){return e instanceof ye}static create(e,t){return new fe(t)}prepareFrame(e){const t=this.layer,n=this.canvases_[this.previousFrame_.canvasId];let r=n;const o=pe(e,n);let i=this.previousFrame_.canvasId;const[a,s]=e.viewState.center,c=e.viewState.resolution;if(!o&&this.previousFrame_.resolution===c){de[0]=this.previousFrame_.centerX,de[1]=this.previousFrame_.centerY,he(e.coordinateToPixelTransform,de);const t=de[0]-e.size[0]/2,o=de[1]-e.size[1]/2;if(0!==t||0!==o){i=(i+1)%2,r=this.canvases_[i],pe(e,r);const a=r.getContext("2d");a.clearRect(0,0,r.width,r.height),a.drawImage(n,t,o)}}this.previousFrame_.canvasId=i,this.previousFrame_.centerX=a,this.previousFrame_.centerY=s,this.previousFrame_.resolution=c;const l=r.getContext("2d");return t.doRender_(e,l),e.animate=!0,!0}composeFrame(e,t,n){const r=this.canvases_[this.previousFrame_.canvasId],o=r.width,i=r.height;n.drawImage(r,0,0,o,i)}}class ye extends ue{constructor(e){super({}),this.doRender_=e.renderFunction}getSourceState(){return"ready"}}function me(e,t){var n,r;t[0]=Math.random()*function(e){return e[2]-e[0]}(e)+e[0],t[1]=(n=Math.random(),r=Math.PI*(n-.5),Math.log(Math.tan(Math.PI/4+r/2))/Math.PI*20037508.34)}class ge extends ye{constructor(e){super({renderFunction:(t,n)=>{let r;return r=e.uvBuffer1?"dimgray":4==brightMode?"#777777":"white",this.render(t,n,r)}}),this.fading=e.fading||.8,console.assert(e.ttl),this.ttl=e.ttl,console.assert(e.map),this.map=e.map,console.assert(e.particleSize1),console.assert(e.particleSize2),this.particleSize1=e.particleSize1,this.particleSize2=e.particleSize2;const t=[e.uvBuffer1,e.uvBuffer2,e.uvBuffer3];for(const e of t)if(e){console.assert(e),this.uvBuffer=e;break}console.assert(e.particles),this.particles=new Array(e.particles);for(let t=0;t<e.particles;++t)this.particles[t]={ttl:Math.random()*this.ttl,coordinates:[]};this.pixel=[],this.viewportWithDataExtent=[1/0,1/0,-1/0,-1/0],this.map.getRenderer().registerLayerRenderers([fe])}render(e,t,n){const r=t.canvas;t.fillStyle=n,this.advanceParticles(e,t),t.globalAlpha=this.fading,t.globalCompositeOperation="destination-in",t.fillRect(0,0,r.width,r.height),t.globalAlpha=1,t.globalCompositeOperation="source-over"}advanceParticles(e,t){if(r=this.uvBuffer.extent,o=e.extent,i=this.viewportWithDataExtent,a=i||[1/0,1/0,-1/0,-1/0],function(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}(r,o)?(r[0]>o[0]?a[0]=r[0]:a[0]=o[0],r[1]>o[1]?a[1]=r[1]:a[1]=o[1],r[2]<o[2]?a[2]=r[2]:a[2]=o[2],r[3]<o[3]?a[3]=r[3]:a[3]=o[3]):function(e){!function(e,t,n,r,o){o&&(o[0]=e,o[1]=t,o[2]=n,o[3]=r)}(1/0,1/0,-1/0,-1/0,e)}(a),(n=this.viewportWithDataExtent)[2]<n[0]||n[3]<n[1])return;var n,r,o,i,a;const s=this.pixel,c=e.viewState.resolution,l=e.pixelRatio;this.particles.forEach((n=>{var r;0!==n.coordinates.length&&function(e,t,n){return e[0]<=t&&t<=e[2]&&e[1]<=n&&n<=e[3]}(this.viewportWithDataExtent,(r=n.coordinates)[0],r[1])||me(this.viewportWithDataExtent,n.coordinates),s[0]=n.coordinates[0],s[1]=n.coordinates[1];const[o,i]=this.uvBuffer.getUVSpeed(n.coordinates);if(0!==o&&0!==i){he(e.coordinateToPixelTransform,s);const r=function(e,t){return Math.atan2(e,t)*(180/Math.PI)}(o,i);t.save(),t.translate(s[0]*l,s[1]*l),t.rotate(r*Math.PI/180),n.ttl>this.ttl/2?t.globalAlpha=2*(1-n.ttl/this.ttl):t.globalAlpha=n.ttl/this.ttl*2,t.fillRect(-this.particleSize1*l/2,-this.particleSize2*l/2,this.particleSize1*l,this.particleSize2*l),t.restore()}--n.ttl,n.ttl<0&&(me(this.viewportWithDataExtent,n.coordinates),n.ttl=this.ttl),n.coordinates[0]+=o*c,n.coordinates[1]+=i*c}))}}let ve=.5;var _e,we,Ee,Le,xe;function Se(){document.getElementById("weatherTime").innerText=Re(weatherTime),addLayerWind||addLayerFlow||addLayerWave?We(!1):(addLayerTempair||addLayerTempwater)&&We(!0)}function Te(){addLayerWind?(addLayerWind=!1,map.removeLayer(layerWind1)):addLayerFlow?(addLayerFlow=!1,map.removeLayer(layerFlow1)):addLayerWave?(addLayerWave=!1,map.removeLayer(layerWave1)):(addLayerTempair||addLayerTempwater)&&(addLayerTempair?(addLayerTempair=!1,map.removeLayer(layerTempair)):addLayerTempwater&&(addLayerTempwater=!1,map.removeLayer(layerTempwater)),document.querySelector("#tempLegend").remove())}function Pe(){const e=document.createElement("div");e.id="tempLegend",e.style.position="absolute",e.style.top="30px",e.style.right="0px",e.style.width="45px",e.style.height="162px",e.style.backgroundImage="url(images/emap/legend_temp.png)",e.style.opacity="1",document.body.appendChild(e)}function be(){console.log("lev : "+lev),ve=0===lev?1:.5,console.log("degree : "+ve)}let Fe;function Me(e){let t;switch(console.log("lev : "+lev),lev){case 0:case 1:t=4;break;case 2:default:t=8;break;case 3:t=5.5;break;case 4:t=6;break;case 5:case 6:t=10.5;break;case 7:case 8:case 9:t=9}console.log("radius : "+t),e.setRadius(t),e.changed()}function Re(e){let t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate();n=n<10?"0"+n:n,r=r<10?"0"+r:r;let o=e.getHours();return o=3*parseInt(o/3)+"시",o=o<10?"0"+o:o,t+"-"+n+"-"+r+" "+o}function Ie(e){weatherTime.setHours(weatherTime.getHours()+e)}function We(t){let n=Re(weatherTime);let r,o,i,a=[1/0,1/0,-1/0,-1/0];!async function(n){let s,c=map.getView().calculateExtent(map.getSize()),l=ol.proj.transform(ol.extent.getBottomLeft(c),"EPSG:3857","EPSG:4326"),u=ol.proj.transform(ol.extent.getTopRight(c),"EPSG:3857","EPSG:4326"),p=-90,h=90;t&&(p=l[1],h=u[1]);let d=n.slice(0,10).replace(/-/g,""),f=n.slice(11,13);if(f.endsWith("시")&&(f=f.charAt(0)),s=await fetch(`./api/weather/all?date=${d}&time=${f}&lat1=${p}&lat2=${h}&lon1=${l[0]}&lon2=${u[0]}&degree=${ve}`),s.ok){try{i=await s.json()}catch(e){return void alert("기상 데이터가 없습니다.")}var y=new Set,m=new Set;i.forEach((function(e){e.hasOwnProperty("lat")&&y.add(e.lat),e.hasOwnProperty("lon")&&m.add(e.lon)})),r=m.size,o=y.size,function(){addLayerWind?map.removeLayer(layerWind1):addLayerFlow?map.removeLayer(layerFlow1):addLayerWave?map.removeLayer(layerWave1):layerTempair?(map.removeLayer(layerTempair),map.removeLayer(layerTempair)):layerTempwater&&(map.removeLayer(layerTempwater),map.removeLayer(layerTempwater));const t=[],n=[],s=[],c=[],l=[],u=[];function p(e,t){return e.map((e=>e[t]))}const h=p(i,"lat"),d=p(i,"lon"),f=p(i,"ugrd10m"),y=p(i,"vgrd10m"),m=p(i,"u_current"),g=p(i,"v_current"),v=p(i,"fwaveu"),_=p(i,"fwavev"),w=p(i,"water_temp"),E=p(i,"fsdir"),L=p(i,"fshgt");for(let r=0;r<h.length;r++){const o=F([parseFloat(d[r]),parseFloat(h[r])]),i=f[r]/27,p=y[r]/27;let x=m[r],S=g[r];0==w[r]&&0==E[r]&&0==L[r]&&(x=0,S=0);let T=v[r]/70,P=_[r]/70;t.push(i),n.push(p),s.push(x),c.push(S),l.push(T),u.push(P),e(a,o)}const x=new Float32Array(t),S=new Float32Array(n),T=new Float32Array(s),P=new Float32Array(c),b=new Float32Array(l),M=new Float32Array(u),I=new R(x,S,r,o,a),W=new R(T,P,r,o,a),O=new R(b,M,r,o,a);let B;if(layerWind1=new ge({map,uvBuffer1:I,particles:1e4,fading:.95,ttl:400,particleSize1:1.5,particleSize2:1.5}),layerFlow1=new ge({map,uvBuffer2:W,particles:2e4,fading:.95,ttl:400,particleSize1:1.5,particleSize2:1.5}),layerWave1=new ge({map,uvBuffer3:O,particles:5e3,fading:.45,ttl:150,particleSize1:6,particleSize2:3}),lev>=3){let e;e=3==lev?.2:lev<=5?.1:lev<=6?.05:lev<=7?.02:lev<=8?.01:lev<=9?.005:.002;const t=[];i.map(((n,r,o)=>{if(r<o.length-1){const i=o[r+1],a=i.lat-n.lat,s=i.lon-n.lon,c=Math.round(Math.abs(a)/e),l=Math.round(Math.abs(s)/e);for(let e=0;e<c;e++)for(let r=0;r<l;r++){const o=a/c*e,u=s/l*r,p=n.lat+o,h=n.lon+u,d=parseFloat(n.air_temp)+(parseFloat(i.air_temp)-parseFloat(n.air_temp))/(c*l)*(e*l+r);t.push({lat:p,lon:h,air_temp:d.toFixed(2)})}}})),B=t}else B=i;layerTempair=new ol.layer.Heatmap({source:new ol.source.Vector({features:B.map((e=>{const t=(Math.min(Math.max(parseFloat(e.air_temp),-20),40)- -20)/60;return new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([parseFloat(e.lon),parseFloat(e.lat)])),weight:t})}))}),blur:15,radius:1,weight:function(e){return e.get("weight")},opacity:.5}),layerTempwater=new ol.layer.Heatmap({source:new ol.source.Vector({features:B.map((e=>{const t=(Math.min(Math.max(parseFloat(e.water_temp),-20),40)- -20)/60;return new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([parseFloat(e.lon),parseFloat(e.lat)])),weight:t})}))}),blur:15,radius:1,weight:function(e){return e.get("weight")},opacity:.5}),addLayerWind&&map.addLayer(layerWind1),addLayerFlow&&map.addLayer(layerFlow1),addLayerWave&&map.addLayer(layerWave1),addLayerTempair&&(map.addLayer(layerTempair),Me(layerTempair)),addLayerTempwater&&(map.addLayer(layerTempwater),Me(layerTempwater))}()}else alert("서버 응답이 없습니다.")}(n)}lev=4,_e=document.getElementById("checkWind"),we=document.getElementById("checkFlow"),Ee=document.getElementById("checkWave"),Le=document.getElementById("checkTempair"),xe=document.getElementById("checkTempwater"),_e.addEventListener("change",(function(){_e.checked&&(Te(),addLayerWind=!0,We(!1))})),we.addEventListener("change",(function(){we.checked&&(Te(),addLayerFlow=!0,We(!1))})),Ee.addEventListener("change",(function(){Ee.checked&&(Te(),addLayerWave=!0,We(!1))})),Le.addEventListener("change",(function(){Le.checked&&(Te(),addLayerTempair=!0,We(!0),Pe())})),xe.addEventListener("change",(function(){xe.checked&&(Te(),addLayerTempwater=!0,We(!0),Pe())})),map.on("movestart",(function(){addLayerWind?map.removeLayer(layerWind1):addLayerFlow?map.removeLayer(layerFlow1):addLayerWave?map.removeLayer(layerWave1):addLayerTempair?map.removeLayer(layerTempair):addLayerTempwater&&map.removeLayer(layerTempwater)})),map.on("moveend",(function(){be(),addLayerWind||addLayerFlow||addLayerWave?We(!1):(addLayerTempair||addLayerTempwater)&&We(!0)})),map.getView().on("change:resolution",(function(){lev=map.getView().getZoom(),clearTimeout(Fe),Fe=setTimeout((function(){Number.isInteger(lev)&&be()}),250)})),document.getElementById("weatherTime").innerText=Re(weatherTime),document.getElementById("timeMinus12").addEventListener("click",(function(){Ie(-12),Se()})),document.getElementById("timeMinus3").addEventListener("click",(function(){Ie(-3),Se()})),document.getElementById("timeNow").addEventListener("click",(function(){weatherTime=new Date,Se()})),document.getElementById("timePlus3").addEventListener("click",(function(){Ie(3),Se()})),document.getElementById("timePlus12").addEventListener("click",(function(){Ie(12),Se()})),dateInput=document.getElementById("selectDate"),dateInput.addEventListener("change",(function(e){let t=new Date(e.target.value);weatherTime=t,Se()}))})();