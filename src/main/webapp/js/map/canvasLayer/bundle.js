(()=>{"use strict";function e(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}var t="cosh"in Math?Math.cosh:function(e){var t=Math.exp(e);return(t+1/t)/2},r={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},n={};n[r.DEGREES]=2*Math.PI*6370997/360,n[r.FEET]=.3048,n[r.METERS]=1,n[r.USFEET]=1200/3937;const o=r;var i=function(e){this.code_=e.code,this.units_=e.units,this.extent_=void 0!==e.extent?e.extent:null,this.worldExtent_=void 0!==e.worldExtent?e.worldExtent:null,this.axisOrientation_=void 0!==e.axisOrientation?e.axisOrientation:"enu",this.global_=void 0!==e.global&&e.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit};i.prototype.canWrapX=function(){return this.canWrapX_},i.prototype.getCode=function(){return this.code_},i.prototype.getExtent=function(){return this.extent_},i.prototype.getUnits=function(){return this.units_},i.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||n[this.units_]},i.prototype.getWorldExtent=function(){return this.worldExtent_},i.prototype.getAxisOrientation=function(){return this.axisOrientation_},i.prototype.isGlobal=function(){return this.global_},i.prototype.setGlobal=function(e){this.global_=e,this.canWrapX_=!(!e||!this.extent_)},i.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},i.prototype.setDefaultTileGrid=function(e){this.defaultTileGrid_=e},i.prototype.setExtent=function(e){this.extent_=e,this.canWrapX_=!(!this.global_||!e)},i.prototype.setWorldExtent=function(e){this.worldExtent_=e},i.prototype.setGetPointResolution=function(e){this.getPointResolutionFunc_=e},i.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};const a=i;var s=6378137,c=Math.PI*s,l=[-c,-c,c,c],u=[-180,-85,180,85],p=function(e){function r(r){e.call(this,{code:r,units:o.METERS,extent:l,global:!0,worldExtent:u,getPointResolution:function(e,r){return e/t(r[1]/s)}})}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r}(a),h=[new p("EPSG:3857"),new p("EPSG:102100"),new p("EPSG:102113"),new p("EPSG:900913"),new p("urn:ogc:def:crs:EPSG:6.18:3:3857"),new p("urn:ogc:def:crs:EPSG::3857"),new p("http://www.opengis.net/gml/srs/epsg.xml#3857")];var d,f,y,m=[-180,-90,180,90],g=6378137*Math.PI/180,v=function(e){function t(t,r){e.call(this,{code:t,units:o.DEGREES,extent:m,axisOrientation:r,global:!0,metersPerUnit:g,worldExtent:m})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(a),_=[new v("CRS:84"),new v("EPSG:4326","neu"),new v("urn:ogc:def:crs:EPSG::4326","neu"),new v("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new v("urn:ogc:def:crs:OGC:1.3:CRS84"),new v("urn:ogc:def:crs:OGC:2:84"),new v("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new v("urn:x-ogc:def:crs:EPSG:4326","neu")],w={},E={};function L(e,t,r){var n=e.getCode(),o=t.getCode();n in E||(E[n]={}),E[n][o]=r}function x(e,t,r){var n;if(void 0!==t){for(var o=0,i=e.length;o<i;++o)t[o]=e[o];n=t}else n=e.slice();return n}function S(e,t,r){if(void 0!==t&&e!==t){for(var n=0,o=e.length;n<o;++n)t[n]=e[n];e=t}return e}function T(e){!function(e,t){w[e]=t}(e.getCode(),e),L(e,e,x)}function b(e){return"string"==typeof e?w[e]||null:e||null}function P(e){!function(e){e.forEach(T)}(e),e.forEach((function(t){e.forEach((function(e){t!==e&&L(t,e,x)}))}))}function M(e,t){return function(e,t,r){return function(e,t){return r=b(e),n=b(t),o=function(e,t){var r;return e in E&&t in E[e]&&(r=E[e][t]),r}(r.getCode(),n.getCode()),o||(o=S),o;var r,n,o}(t,r)(e,void 0,e.length)}(e,"EPSG:4326",void 0!==t?t:"EPSG:3857")}function F(e,t,r){const[n,o]=t,i=Math.floor(n),a=Math.floor(o),s=Math.ceil(n),c=Math.ceil(o),l=n-i,u=o-a,p=r[s+e*a],h=r[i+e*a],d=r[i+e*c];return(p-h)*l+(d-h)*u+(h+r[s+e*c]-p-d)*l*u+h}P(h),P(_),d=h,f=function(e,t,r){var n=e.length,o=r>1?r:2,i=t;void 0===i&&(i=o>2?e.slice():new Array(n));for(var a=c,l=0;l<n;l+=o){i[l]=a*e[l]/180;var u=s*Math.log(Math.tan(Math.PI*(e[l+1]+90)/360));u>a?u=a:u<-a&&(u=-a),i[l+1]=u}return i},y=function(e,t,r){var n=e.length,o=r>1?r:2,i=t;void 0===i&&(i=o>2?e.slice():new Array(n));for(var a=0;a<n;a+=o)i[a]=180*e[a]/c,i[a+1]=360*Math.atan(Math.exp(e[a+1]/s))/Math.PI-90;return i},_.forEach((function(e){d.forEach((function(t){L(e,t,f),L(t,e,y)}))}));class I{constructor(e,t,r,n,o){this.extent=function(e,t){return e.slice()}(o),this.dataWidth_=r,this.dataHeight_=n,this.speedBuffer_=new Float32Array(e.length),this.simpleSpeedBuffer=new Uint8Array(e.length),this.rotationBuffer_=new Float32Array(e.length),this.uBuffer_=e,this.vBuffer_=t;for(let r=0;r<e.length;++r){const n=e[r],o=t[r],i=Math.sqrt(n*n+o*o),a=Math.atan2(o,n);this.speedBuffer_[r]=i,this.simpleSpeedBuffer[r]=Math.ceil(i),this.rotationBuffer_[r]=a}}getUVSpeed(e){const t=this.dataWidth_,r=this.dataHeight_,n=function(e,t,r,n){return[(n[0]-e[0])/(e[2]-e[0])*(t-1),(Math.atan(Math.sinh(n[1]/6378137))*(180/Math.PI)+90)/180*(r-1)]}(this.extent,t,r,e);return[F(t,n,this.uBuffer_),F(t,n,this.vBuffer_)]}getRotation(e){return this.rotationBuffer_[e]}getSpeed(e){return this.speedBuffer_[e]}}var R="function"==typeof Object.assign?Object.assign:function(e,t){var r=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),o=1,i=arguments.length;o<i;++o){var a=r[o];if(null!=a)for(var s in a)a.hasOwnProperty(s)&&(n[s]=a[s])}return n};function W(e){for(var t in e)delete e[t]}function O(e,t,r,n){for(var o,i=0,a=e.length;i<a;++i)if((o=e[i]).listener===t&&o.bindTo===r)return n&&(o.deleteIndex=i),o}function B(e,t){var r=A(e);return r?r[t]:void 0}function A(e,t){var r=e.ol_lm;return!r&&t&&(r=e.ol_lm={}),r}function G(e,t){var r=B(e,t);if(r){for(var n=0,o=r.length;n<o;++n)e.removeEventListener(t,r[n].boundListener),W(r[n]);r.length=0;var i=A(e);i&&(delete i[t],0===Object.keys(i).length&&function(e){delete e.ol_lm}(e))}}function k(e,t,r,n,o){var i=A(e,!0),a=i[t];a||(a=i[t]=[]);var s=O(a,r,n,!1);return s?o||(s.callOnce=!1):(s={bindTo:n,callOnce:!!o,listener:r,target:e,type:t},e.addEventListener(t,function(e){var t=function(t){var r=e.listener,n=e.bindTo||e.target;return e.callOnce&&j(e),r.call(n,t)};return e.boundListener=t,t}(s)),a.push(s)),s}function z(e,t,r,n){return k(e,t,r,n,!0)}function C(e,t,r,n){var o=B(e,t);if(o){var i=O(o,r,n,!0);i&&j(i)}}function j(e){if(e&&e.target){e.target.removeEventListener(e.type,e.boundListener);var t=B(e.target,e.type);if(t){var r="deleteIndex"in e?e.deleteIndex:t.indexOf(e);-1!==r&&t.splice(r,1),0===t.length&&G(e.target,e.type)}W(e)}}const D="change";function K(){return function(){throw new Error("Unimplemented abstract method.")}()}var U=0;function V(e){return e.ol_uid||(e.ol_uid=String(++U))}var X=function(){this.disposed_=!1};X.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},X.prototype.disposeInternal=function(){};const Z=X;function $(){}var H=function(e){this.propagationStopped,this.type=e,this.target=null};H.prototype.preventDefault=function(){this.propagationStopped=!0},H.prototype.stopPropagation=function(){this.propagationStopped=!0};const Y=H;var q=function(e){function t(){e.call(this),this.pendingRemovals_={},this.dispatching_={},this.listeners_={}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addEventListener=function(e,t){var r=this.listeners_[e];r||(r=this.listeners_[e]=[]),-1===r.indexOf(t)&&r.push(t)},t.prototype.dispatchEvent=function(e){var t="string"==typeof e?new Y(e):e,r=t.type;t.target=this;var n,o=this.listeners_[r];if(o){r in this.dispatching_||(this.dispatching_[r]=0,this.pendingRemovals_[r]=0),++this.dispatching_[r];for(var i=0,a=o.length;i<a;++i)if(!1===o[i].call(this,t)||t.propagationStopped){n=!1;break}if(--this.dispatching_[r],0===this.dispatching_[r]){var s=this.pendingRemovals_[r];for(delete this.pendingRemovals_[r];s--;)this.removeEventListener(r,$);delete this.dispatching_[r]}return n}},t.prototype.disposeInternal=function(){!function(e){var t=A(e);if(t)for(var r in t)G(e,r)}(this)},t.prototype.getListeners=function(e){return this.listeners_[e]},t.prototype.hasListener=function(e){return e?e in this.listeners_:Object.keys(this.listeners_).length>0},t.prototype.removeEventListener=function(e,t){var r=this.listeners_[e];if(r){var n=r.indexOf(t);e in this.pendingRemovals_?(r[n]=$,++this.pendingRemovals_[e]):(r.splice(n,1),0===r.length&&delete this.listeners_[e])}},t}(Z);const N=function(e){function t(){e.call(this),this.revision_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.changed=function(){++this.revision_,this.dispatchEvent(D)},t.prototype.getRevision=function(){return this.revision_},t.prototype.on=function(e,t){if(Array.isArray(e)){for(var r=e.length,n=new Array(r),o=0;o<r;++o)n[o]=k(this,e[o],t);return n}return k(this,e,t)},t.prototype.once=function(e,t){if(Array.isArray(e)){for(var r=e.length,n=new Array(r),o=0;o<r;++o)n[o]=z(this,e[o],t);return n}return z(this,e,t)},t.prototype.un=function(e,t){if(Array.isArray(e))for(var r=0,n=e.length;r<n;++r)C(this,e[r],t);else C(this,e,t)},t}(q);var J=function(e){function t(t,r,n){e.call(this,t),this.key=r,this.oldValue=n}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Y),Q={};function ee(e){return Q.hasOwnProperty(e)?Q[e]:Q[e]="change:"+e}const te="opacity",re="visible",ne="extent",oe="zIndex",ie="maxResolution",ae="minResolution",se="source";var ce=function(e){function t(t){e.call(this);var r=R({},t);r[te]=void 0!==t.opacity?t.opacity:1,r[re]=void 0===t.visible||t.visible,r[oe]=t.zIndex,r[ie]=void 0!==t.maxResolution?t.maxResolution:1/0,r[ae]=void 0!==t.minResolution?t.minResolution:0,this.setProperties(r),this.state_=null,this.type}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getType=function(){return this.type},t.prototype.getLayerState=function(){var e,t=this.state_||{layer:this,managed:!0};return t.opacity=(e=this.getOpacity(),0,1,Math.min(Math.max(e,0),1)),t.sourceState=this.getSourceState(),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=this.getZIndex()||0,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),this.state_=t,t},t.prototype.getLayersArray=function(e){return K()},t.prototype.getLayerStatesArray=function(e){return K()},t.prototype.getExtent=function(){return this.get(ne)},t.prototype.getMaxResolution=function(){return this.get(ie)},t.prototype.getMinResolution=function(){return this.get(ae)},t.prototype.getOpacity=function(){return this.get(te)},t.prototype.getSourceState=function(){return K()},t.prototype.getVisible=function(){return this.get(re)},t.prototype.getZIndex=function(){return this.get(oe)},t.prototype.setExtent=function(e){this.set(ne,e)},t.prototype.setMaxResolution=function(e){this.set(ie,e)},t.prototype.setMinResolution=function(e){this.set(ae,e)},t.prototype.setOpacity=function(e){this.set(te,e)},t.prototype.setVisible=function(e){this.set(re,e)},t.prototype.setZIndex=function(e){this.set(oe,e)},t}(function(e){function t(t){e.call(this),V(this),this.values_={},void 0!==t&&this.setProperties(t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(e){var t;return this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t},t.prototype.getKeys=function(){return Object.keys(this.values_)},t.prototype.getProperties=function(){return R({},this.values_)},t.prototype.notify=function(e,t){var r;r=ee(e),this.dispatchEvent(new J(r,e,t)),r="propertychange",this.dispatchEvent(new J(r,e,t))},t.prototype.set=function(e,t,r){if(r)this.values_[e]=t;else{var n=this.values_[e];this.values_[e]=t,n!==t&&this.notify(e,n)}},t.prototype.setProperties=function(e,t){for(var r in e)this.set(r,e[r],t)},t.prototype.unset=function(e,t){if(e in this.values_){var r=this.values_[e];delete this.values_[e],t||this.notify(e,r)}},t}(N));var le=function(e){function t(t){var r=R({},t);delete r.source,e.call(this,r),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,t.map&&this.setMap(t.map),k(this,ee(se),this.handleSourcePropertyChange_,this);var n=t.source?t.source:null;this.setSource(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getLayersArray=function(e){var t=e||[];return t.push(this),t},t.prototype.getLayerStatesArray=function(e){var t=e||[];return t.push(this.getLayerState()),t},t.prototype.getSource=function(){return this.get(se)||null},t.prototype.getSourceState=function(){var e=this.getSource();return e?e.getState():"undefined"},t.prototype.handleSourceChange_=function(){this.changed()},t.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(j(this.sourceChangeKey_),this.sourceChangeKey_=null);var e=this.getSource();e&&(this.sourceChangeKey_=k(e,D,this.handleSourceChange_,this)),this.changed()},t.prototype.setMap=function(e){this.mapPrecomposeKey_&&(j(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(j(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=k(e,"precompose",(function(e){var t=e,r=this.getLayerState();r.managed=!1,void 0===this.getZIndex()&&(r.zIndex=1/0),t.frameState.layerStatesArray.push(r),t.frameState.layerStates[V(this)]=r}),this),this.mapRenderKey_=k(this,D,e.render,e),this.changed())},t.prototype.setSource=function(e){this.set(se,e)},t}(ce);const ue=le;function pe(e,t){let[r,n]=e.size;if(r*=e.pixelRatio,n*=e.pixelRatio,t.width!==r||t.height!==n)return t.width=r,t.height=n,!0}function he(e,t){var r=t[0],n=t[1];return t[0]=e[0]*r+e[2]*n+e[4],t[1]=e[1]*r+e[3]*n+e[5],t}new Array(6);const de=[];class fe extends N{constructor(e){super(),this.layer=e,this.canvases_=[document.createElement("canvas"),document.createElement("canvas")],this.previousFrame_={canvasId:0,centerX:0,centerY:0,resolution:1/0}}static handles(e){return e instanceof ye}static create(e,t){return new fe(t)}prepareFrame(e){const t=this.layer,r=this.canvases_[this.previousFrame_.canvasId];let n=r;const o=pe(e,r);let i=this.previousFrame_.canvasId;const[a,s]=e.viewState.center,c=e.viewState.resolution;if(!o&&this.previousFrame_.resolution===c){de[0]=this.previousFrame_.centerX,de[1]=this.previousFrame_.centerY,he(e.coordinateToPixelTransform,de);const t=de[0]-e.size[0]/2,o=de[1]-e.size[1]/2;if(0!==t||0!==o){i=(i+1)%2,n=this.canvases_[i],pe(e,n);const a=n.getContext("2d");a.clearRect(0,0,n.width,n.height),a.drawImage(r,t,o)}}this.previousFrame_.canvasId=i,this.previousFrame_.centerX=a,this.previousFrame_.centerY=s,this.previousFrame_.resolution=c;const l=n.getContext("2d");return t.doRender_(e,l),e.animate=!0,!0}composeFrame(e,t,r){const n=this.canvases_[this.previousFrame_.canvasId],o=n.width,i=n.height;r.drawImage(n,0,0,o,i)}}class ye extends ue{constructor(e){super({}),this.doRender_=e.renderFunction}getSourceState(){return"ready"}}function me(e,t){var r,n;t[0]=Math.random()*function(e){return e[2]-e[0]}(e)+e[0],t[1]=(r=Math.random(),n=Math.PI*(r-.5),Math.log(Math.tan(Math.PI/4+n/2))/Math.PI*20037508.34)}class ge extends ye{constructor(e){super({renderFunction:(t,r)=>{let n;return n=e.uvBuffer1?"dimgray":4==brightMode?"#777777":"white",this.render(t,r,n)}}),this.fading=e.fading||.8,console.assert(e.ttl),this.ttl=e.ttl,console.assert(e.map),this.map=e.map,console.assert(e.particleSize1),console.assert(e.particleSize2),this.particleSize1=e.particleSize1,this.particleSize2=e.particleSize2;const t=[e.uvBuffer1,e.uvBuffer2,e.uvBuffer3];for(const e of t)if(e){console.assert(e),this.uvBuffer=e;break}console.assert(e.particles),this.particles=new Array(e.particles);for(let t=0;t<e.particles;++t)this.particles[t]={ttl:Math.random()*this.ttl,coordinates:[]};this.pixel=[],this.viewportWithDataExtent=[1/0,1/0,-1/0,-1/0],this.map.getRenderer().registerLayerRenderers([fe])}render(e,t,r){const n=t.canvas;t.fillStyle=r,this.advanceParticles(e,t),t.globalAlpha=this.fading,t.globalCompositeOperation="destination-in",t.fillRect(0,0,n.width,n.height),t.globalAlpha=1,t.globalCompositeOperation="source-over"}advanceParticles(e,t){if(n=this.uvBuffer.extent,o=e.extent,i=this.viewportWithDataExtent,a=i||[1/0,1/0,-1/0,-1/0],function(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}(n,o)?(n[0]>o[0]?a[0]=n[0]:a[0]=o[0],n[1]>o[1]?a[1]=n[1]:a[1]=o[1],n[2]<o[2]?a[2]=n[2]:a[2]=o[2],n[3]<o[3]?a[3]=n[3]:a[3]=o[3]):function(e){!function(e,t,r,n,o){o&&(o[0]=e,o[1]=t,o[2]=r,o[3]=n)}(1/0,1/0,-1/0,-1/0,e)}(a),(r=this.viewportWithDataExtent)[2]<r[0]||r[3]<r[1])return;var r,n,o,i,a;const s=this.pixel,c=e.viewState.resolution,l=e.pixelRatio;this.particles.forEach((r=>{var n;0!==r.coordinates.length&&function(e,t,r){return e[0]<=t&&t<=e[2]&&e[1]<=r&&r<=e[3]}(this.viewportWithDataExtent,(n=r.coordinates)[0],n[1])||me(this.viewportWithDataExtent,r.coordinates),s[0]=r.coordinates[0],s[1]=r.coordinates[1];const[o,i]=this.uvBuffer.getUVSpeed(r.coordinates);if(0!==o&&0!==i){he(e.coordinateToPixelTransform,s);const n=function(e,t){return Math.atan2(e,t)*(180/Math.PI)}(o,i);t.save(),t.translate(s[0]*l,s[1]*l),t.rotate(n*Math.PI/180),r.ttl>this.ttl/2?t.globalAlpha=2*(1-r.ttl/this.ttl):t.globalAlpha=r.ttl/this.ttl*2,t.fillRect(-this.particleSize1*l/2,-this.particleSize2*l/2,this.particleSize1*l,this.particleSize2*l),t.restore()}--r.ttl,r.ttl<0&&(me(this.viewportWithDataExtent,r.coordinates),r.ttl=this.ttl),r.coordinates[0]+=o*c,r.coordinates[1]+=i*c}))}}let ve=.5;var _e,we,Ee,Le,xe;function Se(){Te(!0),document.getElementById("weatherTime").innerText=Ie(weatherTime),addLayerWind||addLayerFlow||addLayerWave?We(!1):(addLayerTempair||addLayerTempwater)&&We(!0)}function Te(e){if(4!=brightMode&&map.removeLayer(worldcountries),addLayerWind)e||(addLayerWind=!1),map.removeLayer(layerWind1);else if(addLayerFlow)e||(addLayerFlow=!1),map.removeLayer(layerFlow1);else if(addLayerWave)e||(addLayerWave=!1),map.removeLayer(layerWave1);else if(addLayerTempair||addLayerTempwater){addLayerTempair?(e||(addLayerTempair=!1),map.removeLayer(layerTempair)):addLayerTempwater&&(e||(addLayerTempwater=!1),map.removeLayer(layerTempwater));const t=document.querySelector("#tempLegend");t&&t.remove()}}function be(){const e=document.createElement("div");e.id="tempLegend",e.style.position="absolute",e.style.top="30px",e.style.right="0px",e.style.width="45px",e.style.height="162px",e.style.backgroundImage="url(images/emap/legend_temp.png)",e.style.opacity="1",document.body.appendChild(e)}function Pe(){ve=0===lev?1:.5}let Me;function Fe(e){let t;switch(console.log("lev : "+lev),lev){case 0:case 1:t=4;break;case 2:default:t=8;break;case 3:t=5.5;break;case 4:t=6;break;case 5:case 6:t=10.5;break;case 7:case 8:case 9:t=9}console.log("radius : "+t),e.setRadius(t),e.changed()}function Ie(e){let t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate();r=r<10?"0"+r:r,n=n<10?"0"+n:n;let o=e.getHours();return o=3*parseInt(o/3)+"시",o=o<10?"0"+o:o,t+"-"+r+"-"+n+" "+o}function Re(e){weatherTime.setHours(weatherTime.getHours()+e)}function We(t){let r=Ie(weatherTime);let n,o,i,a=[1/0,1/0,-1/0,-1/0];!async function(r){let s,c=map.getView().calculateExtent(map.getSize()),l=ol.proj.transform(ol.extent.getBottomLeft(c),"EPSG:3857","EPSG:4326"),u=ol.proj.transform(ol.extent.getTopRight(c),"EPSG:3857","EPSG:4326"),p=-90,h=90;t&&(p=l[1],h=u[1]);let d=r.slice(0,10).replace(/-/g,""),f=r.slice(11,13);f.endsWith("시")&&(f=f.charAt(0));let y=0;if(t&&(y=1),s=await fetch(`./api/weather/all?date=${d}&time=${f}&lat1=${p}&lat2=${h}&lon1=${l[0]}&lon2=${u[0]}&degree=${ve}&data=${y}`),s.ok){try{i=await s.json()}catch(e){return void alert("기상 데이터가 없습니다.")}var m=new Set,g=new Set;i.forEach((function(e){e.hasOwnProperty("lat")&&m.add(e.lat),e.hasOwnProperty("lon")&&g.add(e.lon)})),n=g.size,o=m.size,function(){addLayerWind?map.removeLayer(layerWind1):addLayerFlow?map.removeLayer(layerFlow1):addLayerWave?map.removeLayer(layerWave1):layerTempair?(map.removeLayer(layerTempair),map.removeLayer(layerTempair)):layerTempwater&&(map.removeLayer(layerTempwater),map.removeLayer(layerTempwater));const t=[],r=[],s=[],c=[],l=[],u=[];function p(e,t){return e.map((e=>e[t]))}const h=p(i,"lat"),d=p(i,"lon"),f=p(i,"ugrd10m"),y=p(i,"vgrd10m"),m=p(i,"u_current"),g=p(i,"v_current"),v=p(i,"fwaveu"),_=p(i,"fwavev");for(let n=0;n<h.length;n++){const o=M([parseFloat(d[n]),parseFloat(h[n])]),i=f[n]/27,p=y[n]/27;let w=m[n],E=g[n],L=v[n]/70,x=_[n]/70;t.push(i),r.push(p),s.push(w),c.push(E),l.push(L),u.push(x),e(a,o)}const w=new Float32Array(t),E=new Float32Array(r),L=new Float32Array(s),x=new Float32Array(c),S=new Float32Array(l),T=new Float32Array(u),b=new I(w,E,n,o,a),P=new I(L,x,n,o,a),F=new I(S,T,n,o,a);let R;if(layerWind1=new ge({map,uvBuffer1:b,particles:1e4,fading:.95,ttl:400,particleSize1:1.5,particleSize2:1.5}),layerFlow1=new ge({map,uvBuffer2:P,particles:2e4,fading:.95,ttl:400,particleSize1:1.5,particleSize2:1.5}),layerWave1=new ge({map,uvBuffer3:F,particles:5e3,fading:.45,ttl:150,particleSize1:6,particleSize2:3}),lev>=3){let e;e=3==lev?.2:lev<=5?.1:lev<=6?.05:lev<=7?.02:lev<=8?.01:lev<=9?.005:.002;const t=[];i.map(((r,n,o)=>{if(n<o.length-1){const i=o[n+1],a=i.lat-r.lat,s=i.lon-r.lon,c=Math.round(Math.abs(a)/e),l=Math.round(Math.abs(s)/e);for(let e=0;e<c;e++)for(let n=0;n<l;n++){const o=a/c*e,u=s/l*n,p=r.lat+o,h=r.lon+u,d=parseFloat(r.air_temp)+(parseFloat(i.air_temp)-parseFloat(r.air_temp))/(c*l)*(e*l+n);t.push({lat:p,lon:h,air_temp:d.toFixed(2)})}}})),R=t}else R=i;layerTempair=new ol.layer.Heatmap({source:new ol.source.Vector({features:R.map((e=>{const t=(Math.min(Math.max(parseFloat(e.air_temp),-20),40)- -20)/60;return new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([parseFloat(e.lon),parseFloat(e.lat)])),weight:t})}))}),blur:15,radius:1,weight:function(e){return e.get("weight")},opacity:.5}),layerTempwater=new ol.layer.Heatmap({source:new ol.source.Vector({features:R.map((e=>{const t=(Math.min(Math.max(parseFloat(e.water_temp),-20),40)- -20)/60;return new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([parseFloat(e.lon),parseFloat(e.lat)])),weight:t})}))}),blur:15,radius:1,weight:function(e){return e.get("weight")},opacity:.5}),addLayerWind?(map.addLayer(layerWind1),worldcountries.setZIndex(-1)):addLayerFlow?(map.addLayer(layerFlow1),4!=brightMode?map.addLayer(worldcountries):worldcountries.setZIndex(1)):addLayerWave?(map.addLayer(layerWave1),4!=brightMode?map.addLayer(worldcountries):worldcountries.setZIndex(1)):addLayerTempair?(map.addLayer(layerTempair),Fe(layerTempair),worldcountries.setZIndex(-1)):addLayerTempwater&&(map.addLayer(layerTempwater),Fe(layerTempwater),4!=brightMode?map.addLayer(worldcountries):worldcountries.setZIndex(1))}()}else alert("서버 응답이 없습니다.")}(r)}lev=4,_e=document.getElementById("checkWind"),we=document.getElementById("checkFlow"),Ee=document.getElementById("checkWave"),Le=document.getElementById("checkTempair"),xe=document.getElementById("checkTempwater"),_e.addEventListener("change",(function(){_e.checked&&(Te(!1),addLayerWind=!0,We(!1))})),we.addEventListener("change",(function(){we.checked&&(Te(!1),addLayerFlow=!0,We(!1))})),Ee.addEventListener("change",(function(){Ee.checked&&(Te(!1),addLayerWave=!0,We(!1))})),Le.addEventListener("change",(function(){Le.checked&&(Te(!1),addLayerTempair=!0,We(!0),be())})),xe.addEventListener("change",(function(){xe.checked&&(Te(!1),addLayerTempwater=!0,We(!0),be())})),map.on("movestart",(function(){4!=brightMode&&map.removeLayer(worldcountries),addLayerWind?map.removeLayer(layerWind1):addLayerFlow?map.removeLayer(layerFlow1):addLayerWave?map.removeLayer(layerWave1):addLayerTempair?map.removeLayer(layerTempair):addLayerTempwater&&map.removeLayer(layerTempwater)})),map.on("moveend",(function(){Pe(),addLayerWind||addLayerFlow||addLayerWave?We(!1):(addLayerTempair||addLayerTempwater)&&We(!0)})),map.getView().on("change:resolution",(function(){lev=map.getView().getZoom(),clearTimeout(Me),Me=setTimeout((function(){Number.isInteger(lev)&&Pe()}),250)})),document.getElementById("weatherTime").innerText=Ie(weatherTime),document.getElementById("timeMinus12").addEventListener("click",(function(){Re(-12),Se()})),document.getElementById("timeMinus3").addEventListener("click",(function(){Re(-3),Se()})),document.getElementById("timeNow").addEventListener("click",(function(){weatherTime=new Date,Se()})),document.getElementById("timePlus3").addEventListener("click",(function(){Re(3),Se()})),document.getElementById("timePlus12").addEventListener("click",(function(){Re(12),Se()})),dateInput=document.getElementById("selectDate"),dateInput.addEventListener("change",(function(e){let t=new Date(e.target.value);weatherTime=t,Se()}))})();